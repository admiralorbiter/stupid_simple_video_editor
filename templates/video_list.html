{% if videos %}
<div class="video-list">
    {% for video in videos %}
    <div class="video-list-item" 
         data-video-id="{{ video.id }}"
         hx-get="/edit-video/{{ video.id }}"
         hx-target="#editor-content"
         hx-trigger="click">
        <div class="video-thumbnail">
            {% if video.thumbnail_path %}
                <div class="placeholder-thumbnail active">
                    <i class="bi bi-camera-video"></i>
                    <small class="loading-text">Loading...</small>
                </div>
                <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" 
                     data-src="{{ url_for('static', filename=video.thumbnail_path) }}" 
                     alt="{{ video.title }}"
                     class="video-thumbnail-img lazy"
                     fetchpriority="low"
                     loading="lazy"
                     onload="this.parentElement.querySelector('.placeholder-thumbnail').classList.remove('active'); this.classList.add('loaded');">
            {% else %}
                <div class="placeholder-thumbnail active">
                    <i class="bi bi-camera-video"></i>
                </div>
            {% endif %}
        </div>
        <div class="video-info">
            <h5 class="video-title">{{ video.title }}</h5>
            <div class="video-metadata">
                <small class="duration">
                    <i class="bi bi-clock me-1"></i>
                    {{ video.file_path | duration }}
                </small>
                {% if video.clip_count > 0 %}
                    <small class="clip-count">
                        <i class="bi bi-scissors me-1"></i>
                        {{ video.clip_count }} clip{{ 's' if video.clip_count != 1 }}
                    </small>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<style>
.video-thumbnail {
    position: relative;
    background-color: #f8f9fa;
    aspect-ratio: 16/9;
    overflow: hidden;
}

.placeholder-thumbnail {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f8f9fa;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.placeholder-thumbnail.active {
    opacity: 1;
}

.video-thumbnail-img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.video-thumbnail-img.loaded {
    opacity: 1;
}

.bi-camera-video {
    font-size: 2rem;
    color: #6c757d;
}

.text-contrast {
    color: #333;
    text-shadow: 
        0px 0px 1px rgba(255,255,255,0.5),
        0px 0px 2px rgba(255,255,255,0.3);
}

.video-list-item {
    position: relative;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 
        0 2px 4px rgba(0,0,0,0.1),
        0 0 0 1px rgba(255,255,255,0.5);
    transition: transform 0.2s, box-shadow 0.2s;
}

.video-list-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.video-list-item.selected {
    background: rgba(255, 255, 255, 0.98);
    border: 2px solid #483D8B;
    box-shadow: 
        0 4px 8px rgba(0,0,0,0.15),
        0 0 0 2px rgba(72, 61, 139, 0.5);
}

.video-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #2B2B2B;
    margin-bottom: 0.25rem;
    text-shadow: 
        0 0 1px rgba(255,255,255,0.8),
        0 0 2px rgba(255,255,255,0.6);
}

.video-metadata {
    display: flex;
    gap: 15px;
    align-items: center;
    margin-top: 5px;
    color: #2B2B2B;
    font-weight: 500;
}

.video-metadata small {
    background-color: rgba(255, 255, 255, 0.8);
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.85rem;
}

.loading-text {
    display: block;
    margin-top: 5px;
    color: #483D8B;
    font-weight: 500;
    background-color: rgba(255, 255, 255, 0.9);
    padding: 2px 8px;
    border-radius: 4px;
}

/* Improve placeholder visibility */
.placeholder-thumbnail.active {
    opacity: 1;
    background: #f8f9fa;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 10px;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const lazyLoadObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                // Small delay to help with initial page load
                setTimeout(() => {
                    img.src = img.dataset.src;
                }, 100);
                observer.unobserve(img);
            }
        });
    }, {
        root: null,
        rootMargin: "50px",
        threshold: 0.1
    });

    // Get all lazy images and observe them
    document.querySelectorAll("img.lazy").forEach(img => {
        lazyLoadObserver.observe(img);
    });
});

// Add selection highlight
document.querySelectorAll('.video-list-item').forEach(item => {
    item.addEventListener('click', () => {
        document.querySelectorAll('.video-list-item').forEach(i => i.classList.remove('selected'));
        item.classList.add('selected');
    });
});
</script>

{% else %}
<div id="loading-videos" class="htmx-indicator text-center p-5">
    <div class="spinner-border text-primary mb-3"></div>
    <p>Scanning videos and generating thumbnails...</p>
</div>
<div class="text-center text-muted p-5" id="no-videos-message">
    <i class="bi bi-camera-reels display-1"></i>
    <p class="mt-3">No videos found. Import some videos to get started!</p>
</div>
{% endif %} 